<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://olllooo.com/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://olllooo.com/atom.xml"><link rel="alternate" type="application/json" href="https://olllooo.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="建站"><link rel="canonical" href="https://olllooo.com/aaabbb/Ubuntu%20install%20nginxphp/"><title>Ubuntu部署nginx和php - AAABBB | olllooo =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Ubuntu部署nginx和php</h1><div class="meta"><span class="item" title="创建时间：2022-08-02 11:20:12"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-02T11:20:12+08:00">2022-08-02</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">olllooo</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/img/2.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/aaabbb/" itemprop="item" rel="index" title="分类于 AAABBB"><span itemprop="name">AAABBB</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://olllooo.com/aaabbb/Ubuntu%20install%20nginxphp/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content=""><meta itemprop="description" content=", 学会忘记和放下"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><p>使用 nginx+php 搭建网站。[<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9saW51eF9wYWNrYWdlcy5odG1sI1VidW50dQ==">官方连接</span>]</p><p><span id="more"></span></p><hr><h3 id="1ubuntu"><a class="anchor" href="#1ubuntu">#</a> 1.Ubuntu</h3><h4 id="11更新包"><a class="anchor" href="#11更新包">#</a> 1.1. 更新包</h4><p><code>apt update</code><br><code>apt full-upgrade</code></p><h4 id="12nginx安装配置"><a class="anchor" href="#12nginx安装配置">#</a> 1.2.nginx 安装配置</h4><p>安装<br><code>apt install curl gnupg2 ca-certificates lsb-release -y</code><br><code>vim /etc/apt/sources.list.d/nginx.list</code></p><pre><code>#主线版
deb http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx
</code></pre><p>或</p><pre><code>#稳定版
deb http://nginx.org/packages/ubuntu `lsb_release -cs` nginx
</code></pre><p><code>curl -fsSL https://nginx.org/keys/nginx_signing.key | apt-key add -</code><br><code>apt install nginx -y</code><br><code>ps -aux | grep nginx</code></p><p>修改配置文件，修改端口<br><code>vim /etc/nginx/sites-available/default</code></p><pre><code>listen 443 default_server;
listen [::]:80 default_server;
</code></pre><p>日志时间与时区一致<br><code>cp /usr/share/zoneinfo/Asia/Ho_Chi_Minh /etc/localtime</code><br><code>vim /etc/nginx/sites-available/default</code></p><pre><code>autoindex_localtime on;		#时间同步
</code></pre><p>配置优先级<br>在 index.html 前面加入 index.php<br><code>vim /etc/nginx/sites-available/default</code></p><p>解析到 php-fpm 路径<br><code>vim /etc/nginx/sites-available/default</code></p><pre><code>location ~ \.php$ &#123;
	include snippets/fastcgi-php.conf;
	fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
&#125;
</code></pre><p>SSL 证书配置<br><code>vim /etc/nginx/sites-available/default</code></p><figure class="highlight text"><figcaption data-lang="text"><span>t</span></figcaption><table><tr><td data-num="1"></td><td><pre>server &#123;  </pre></td></tr><tr><td data-num="2"></td><td><pre>	listen 80;</pre></td></tr><tr><td data-num="3"></td><td><pre>	listen 443 ssl;</pre></td></tr><tr><td data-num="4"></td><td><pre>	#server_name example.com www.example.com;		#如果没有则添加</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>	ssl off;				*[注释掉或者修改成off可同时处理HTTP请求和HTTPS请求]*</pre></td></tr><tr><td data-num="7"></td><td><pre>	ssl_certificate /etc/ssl/private/microsoft.com.crt;</pre></td></tr><tr><td data-num="8"></td><td><pre>	#ssl_certificate /etc/ssl/private/microsoft.com.pem;</pre></td></tr><tr><td data-num="9"></td><td><pre>	#ssl_certificate c:/nginx/ssl/private/microsoft.com.pem;</pre></td></tr><tr><td data-num="10"></td><td><pre>	ssl_certificate_key /etc/ssl/private/microsoft.com.key;</pre></td></tr><tr><td data-num="11"></td><td><pre>&#125;</pre></td></tr></table></figure><p>根据 useragent 过滤<br>如果不等于，则返回 404<br><code>vim /etc/nginx/sites-available/default</code></p><pre><code>server &#123; 
	location / &#123;
                try_files $uri $uri/ =404;
                if ($http_user_agent != &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot;)&#123;
                        return 404;
                &#125;
        &#125;
&#125;
</code></pre><p>强制跳转 HTTPS<br><code>vim /etc/nginx/sites-available/default</code></p><pre><code>if ($scheme = http ) &#123;return 301 https://$host$request_uri;&#125;
</code></pre><p>支持中文编码<br><code>vim /etc/default/locale</code></p><pre><code>LANG=&quot;en_US.UTF-8&quot;
LANGUAGE=&quot;en_US:en&quot;
</code></pre><p><code>vim /etc/nginx/sites-available/default</code></p><pre><code>charset utf-8;
</code></pre><p><code>locale-gen en_US en_US.UTF-8</code><br><code>reboot</code></p><p>keepalive 配置<br><code>vim /etc/nginx/nginx.conf</code></p><pre><code>keepalive_timeout 65;
</code></pre><p>访问白名单<br><code>vim /etc/nginx/sites-available/default</code></p><pre><code>server &#123;
	listen       80;
	server_name  192.168.1.1;
	index index.html index.htm index.php;
	root /data/www/app/webroot;
	charset utf-8;
	allow 192.168.1.2;
	allow 192.168.1.3;
	deny all;
	
	location ~ .*\.php$ &#123;
		include fcgi.conf;
		fastcgi_pass  127.4.0.1:10080;
		fastcgi_index index.php;
		expires off;
		access_log on;
		access_log  /data/logs/dpcq_php.log
		access buffer=32k;
	&#125;
&#125;
</code></pre><h4 id="13php安装配置"><a class="anchor" href="#13php安装配置">#</a> 1.3.php 安装配置</h4><p>安装<br><code>apt install php7.2</code><br><code>apt install php7.2-fpm</code> #nginx 与 php 之间的桥梁<br><code>apt install php-json php-curl php7.2-mysql php7.2-cgi</code> # 安装必要依赖<br>( <code>apt install php7.2 php7.2-fpm php-json php-curl php7.2-mysql php7.2-cgi -y</code> )</p><p>配置 php-frm<br><code>vim /etc/php/7.2/fpm/php.ini</code></p><pre><code>cgi.fix_pathinfo=0
</code></pre><p>重启服务<br><code>service php7.2-fpm restart</code><br><code>service nginx restart</code></p><p>测试页面<br><code>vim /var/www/html/index.php</code></p><pre><code>&lt;?php
echo &quot;This is a PHP test page&quot;;
?&gt;
</code></pre><h3 id="2centos"><a class="anchor" href="#2centos">#</a> 2.CentOS</h3><h4 id="21更新包"><a class="anchor" href="#21更新包">#</a> 2.1. 更新包</h4><p><code>yum makecache</code><br><code>yum update</code></p><h4 id="22nginx安装"><a class="anchor" href="#22nginx安装">#</a> 2.2.nginx 安装</h4><p><code>yum install yum-utils -y</code><br><code>vim /etc/yum.repos.d/nginx.repo</code></p><pre><code>#稳定版
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre><p>或</p><pre><code>#主线版  
[nginx-mainline]	
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
</code></pre><p><code>yum-config-manager --enable nginx-mainline</code><br><code>yum install nginx -y</code><br><code>systemctl enable nginx</code><br><code>systemctl start nginx</code></p><h4 id="23php安装"><a class="anchor" href="#23php安装">#</a> 2.3.php 安装</h4><p><code>yum install php php-fpm php-mysql php-devel php-gd php-pecl-memcache php-pspell php-snmp php-xmlrpc php-xml php-pdo php-pgsql php-pecl-redis php-soap</code></p><h3 id="3权限分配"><a class="anchor" href="#3权限分配">#</a> 3. 权限分配</h3><p>如果作为上线使用，需要对根目录及 php 文件赋予权限<br><code>chmod 777 /var/www/html/</code><br><code>chmod 777 /var/www/html/index.php</code><br>&lt;br /&gt;<br>&lt;br /&gt;</p><p>-- End --<br>&lt;font color=#D3D3D3 size=1.5&gt;FN:20220802112012&lt;/font&gt;</p><div class="tags"><a href="/tags/%E5%BB%BA%E7%AB%99/" rel="tag"><i class="ic i-tag"></i> 建站</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-11-29 10:22:38" itemprop="dateModified" datetime="2022-11-29T10:22:38+08:00">2022-11-29</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt=" 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt=" 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt=" 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong><i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://olllooo.com/aaabbb/Ubuntu%20install%20nginxphp/" title="Ubuntu部署nginx和php">https://olllooo.com/aaabbb/Ubuntu install nginxphp/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"></div><div class="item right"><a href="/hello-world/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciub8ja1j20zk0m81ky.jpg" title="Hello World"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>Hello World</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ubuntu"><span class="toc-number">1.</span> <span class="toc-text">1.Ubuntu</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11%E6%9B%B4%E6%96%B0%E5%8C%85"><span class="toc-number">1.1.</span> <span class="toc-text">1.1. 更新包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12nginx%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">1.2.nginx 安装配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13php%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">1.3.php 安装配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2centos"><span class="toc-number">2.</span> <span class="toc-text">2.CentOS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#21%E6%9B%B4%E6%96%B0%E5%8C%85"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. 更新包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22nginx%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">2.2.nginx 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23php%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">2.3.php 安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%9D%83%E9%99%90%E5%88%86%E9%85%8D"><span class="toc-number">3.</span> <span class="toc-text">3. 权限分配</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/aaabbb/Ubuntu%20install%20nginxphp/" rel="bookmark" title="Ubuntu部署nginx和php">Ubuntu部署nginx和php</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="" data-src="/images/avatar.jpg"><p class="name" itemprop="name"></p><div class="description" itemprop="description">学会忘记和放下</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">124</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">1</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">1</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2013 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">@ olllooo</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"aaabbb/Ubuntu install nginxphp/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>